/*:
 * @plugindesc Allows you to check for Input within Yanfly's Action Sequences.
 * @author SumRndmDde
 *
 * @param == Custom Inputs ==
 * @default
 *
 * @param Name Input 1
 * @desc The name for Custom Input 1.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default tap
 *
 * @param Condition Input 1
 * @desc The JavaScript condition for Custom Input 1.
 * @default TouchInput.isTriggered()
  *
 * @param Name Input 2
 * @desc The name for Custom Input 2.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 2
 * @desc The JavaScript condition for Custom Input 2.
 * @default
 *
 * @param Name Input 3
 * @desc The name for Custom Input 3.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 3
 * @desc The JavaScript condition for Custom Input 3.
 * @default
 *
 * @param Name Input 4
 * @desc The name for Custom Input 4.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 4
 * @desc The JavaScript condition for Custom Input 4.
 * @default
 *
 * @param Name Input 5
 * @desc The name for Custom Input 5.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 5
 * @desc The JavaScript condition for Custom Input 5.
 * @default
 *
 * @param Name Input 6
 * @desc The name for Custom Input 6.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 6
 * @desc The JavaScript condition for Custom Input 6.
 * @default
 *
 * @param Name Input 7
 * @desc The name for Custom Input 7.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 7
 * @desc The JavaScript condition for Custom Input 7.
 * @default
 *
 * @param Name Input 8
 * @desc The name for Custom Input 8.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 8
 * @desc The JavaScript condition for Custom Input 8.
 * @default
 *
 * @param Name Input 9
 * @desc The name for Custom Input 9.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 9
 * @desc The JavaScript condition for Custom Input 9.
 * @default
 *
 * @param Name Input 10
 * @desc The name for Custom Input 10.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 10
 * @desc The JavaScript condition for Custom Input 10.
 * @default
 *
 * @param Name Input 11
 * @desc The name for Custom Input 11.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 11
 * @desc The JavaScript condition for Custom Input 11.
 * @default
 *
 * @param Name Input 12
 * @desc The name for Custom Input 12.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 12
 * @desc The JavaScript condition for Custom Input 12.
 * @default
 *
 * @param Name Input 13
 * @desc The name for Custom Input 13.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 13
 * @desc The JavaScript condition for Custom Input 13.
 * @default
 *
 * @param Name Input 14
 * @desc The name for Custom Input 14.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 14
 * @desc The JavaScript condition for Custom Input 14.
 * @default
 *
 * @param Name Input 15
 * @desc The name for Custom Input 15.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 15
 * @desc The JavaScript condition for Custom Input 15.
 * @default
 *
 * @param Name Input 16
 * @desc The name for Custom Input 16.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 16
 * @desc The JavaScript condition for Custom Input 16.
 * @default
 *
 * @param Name Input 17
 * @desc The name for Custom Input 17.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 17
 * @desc The JavaScript condition for Custom Input 17.
 * @default
 *
 * @param Name Input 18
 * @desc The name for Custom Input 18.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 18
 * @desc The JavaScript condition for Custom Input 18.
 * @default
 *
 * @param Name Input 19
 * @desc The name for Custom Input 19.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 19
 * @desc The JavaScript condition for Custom Input 19.
 * @default
 *
 * @param Name Input 20
 * @desc The name for Custom Input 20.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 20
 * @desc The JavaScript condition for Custom Input 20.
 * @default
 *
 * @param Name Input 21
 * @desc The name for Custom Input 21.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 21
 * @desc The JavaScript condition for Custom Input 21.
 * @default
 *
 * @param Name Input 22
 * @desc The name for Custom Input 22.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 22
 * @desc The JavaScript condition for Custom Input 22.
 * @default
 *
 * @param Name Input 23
 * @desc The name for Custom Input 23.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 23
 * @desc The JavaScript condition for Custom Input 23.
 * @default
 *
 * @param Name Input 24
 * @desc The name for Custom Input 24.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 24
 * @desc The JavaScript condition for Custom Input 24.
 * @default
 *
 * @param Name Input 25
 * @desc The name for Custom Input 25.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 25
 * @desc The JavaScript condition for Custom Input 25.
 * @default
 *
 * @param Name Input 26
 * @desc The name for Custom Input 26.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 26
 * @desc The JavaScript condition for Custom Input 26.
 * @default
 *
 * @param Name Input 27
 * @desc The name for Custom Input 27.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 27
 * @desc The JavaScript condition for Custom Input 27.
 * @default
 *
 * @param Name Input 28
 * @desc The name for Custom Input 28.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 28
 * @desc The JavaScript condition for Custom Input 28.
 * @default
 *
 * @param Name Input 29
 * @desc The name for Custom Input 29.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 29
 * @desc The JavaScript condition for Custom Input 29.
 * @default
 *
 * @param Name Input 30
 * @desc The name for Custom Input 30.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 30
 * @desc The JavaScript condition for Custom Input 30.
 * @default
 *
 * @param Name Input 31
 * @desc The name for Custom Input 31.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 31
 * @desc The JavaScript condition for Custom Input 31.
 * @default
 *
 * @param Name Input 32
 * @desc The name for Custom Input 32.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 32
 * @desc The JavaScript condition for Custom Input 32.
 * @default
 *
 * @param Name Input 33
 * @desc The name for Custom Input 33.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 33
 * @desc The JavaScript condition for Custom Input 33.
 * @default
 *
 * @param Name Input 34
 * @desc The name for Custom Input 34.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 34
 * @desc The JavaScript condition for Custom Input 34.
 * @default
 *
 * @param Name Input 35
 * @desc The name for Custom Input 35.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 35
 * @desc The JavaScript condition for Custom Input 35.
 * @default
 *
 * @param Name Input 36
 * @desc The name for Custom Input 36.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 36
 * @desc The JavaScript condition for Custom Input 36.
 * @default
 *
 * @param Name Input 37
 * @desc The name for Custom Input 37.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 37
 * @desc The JavaScript condition for Custom Input 37.
 * @default
 *
 * @param Name Input 38
 * @desc The name for Custom Input 38.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 38
 * @desc The JavaScript condition for Custom Input 38.
 * @default
 *
 * @param Name Input 39
 * @desc The name for Custom Input 39.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 39
 * @desc The JavaScript condition for Custom Input 39.
 * @default
 *
 * @param Name Input 40
 * @desc The name for Custom Input 40.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 40
 * @desc The JavaScript condition for Custom Input 40.
 * @default
 *
 * @param Name Input 41
 * @desc The name for Custom Input 41.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 41
 * @desc The JavaScript condition for Custom Input 41.
 * @default
 *
 * @param Name Input 42
 * @desc The name for Custom Input 42.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 42
 * @desc The JavaScript condition for Custom Input 42.
 * @default
 *
 * @param Name Input 43
 * @desc The name for Custom Input 43.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 43
 * @desc The JavaScript condition for Custom Input 43.
 * @default
 *
 * @param Name Input 44
 * @desc The name for Custom Input 44.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 44
 * @desc The JavaScript condition for Custom Input 44.
 * @default
 *
 * @param Name Input 45
 * @desc The name for Custom Input 45.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 45
 * @desc The JavaScript condition for Custom Input 45.
 * @default
 *
 * @param Name Input 46
 * @desc The name for Custom Input 46.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 46
 * @desc The JavaScript condition for Custom Input 46.
 * @default
 *
 * @param Name Input 47
 * @desc The name for Custom Input 47.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 47
 * @desc The JavaScript condition for Custom Input 47.
 * @default
 *
 * @param Name Input 48
 * @desc The name for Custom Input 48.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 48
 * @desc The JavaScript condition for Custom Input 48.
 * @default
 *
 * @param Name Input 49
 * @desc The name for Custom Input 49.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 49
 * @desc The JavaScript condition for Custom Input 49.
 * @default
 *
 * @param Name Input 50
 * @desc The name for Custom Input 50.
 * Check it by doing - START SEQUENCE INPUT: name, # 
 * @default
 *
 * @param Condition Input 50
 * @desc The JavaScript condition for Custom Input 50.
 * @default
 *
 * @help
 *
 * Sequence Input
 * Version 1.00
 * SumRndmDde
 *
 *
 *
 * This Plugin requires Yanfly's Battle Engine:
 *
 * Yanfly's Battle Engine Core
 *    (http://yanfly.moe/2015/10/10/yep-3-battle-engine-core/)
 *
 * Yanfly's Action Sequences
 *    (http://yanfly.moe/2015/10/11/yep-4-action-sequence-pack-1/)
 *    (http://yanfly.moe/2015/10/12/yep-5-action-sequence-pack-2/)
 *    (http://yanfly.moe/2015/10/12/yep-6-action-sequence-pack-3/)
 *
 *
 * This Plugin allows you to check for Input within Yanfly's Action Sequences.
 *
 * Here's a list of all the available Actions added through this Plugin that 
 * can be used in the Action Sequences:
 *
 *
 * ==========================================================================
 *  START SEQUENCE INPUT
 * ==========================================================================
 *
 * In order to begin, let's look at this Action:
 *
 *   START SEQUENCE INPUT: input, varId
 *
 * This Action starts a check for an Input.
 * The first parameter, 'input', is the Input that is checked for.
 * There are a couple built in Inputs in RPG Maker MV:
 *
 *  ok      -  Z, ENTER, SPACE
 *  escape  -  X, ESC, INSERT
 *  shift   -  SHIFT
 *  tab     -  TAB
 *  control -  CTRL, ALT
 *  right   -  RIGHT ARROW
 *  left    -  LEFT ARROW
 *  up      -  UP ARROW
 *  down    -  DOWN ARROW
 *
 * You can use any of these or any others added through external Plugins.
 *
 * The 'varId' parameter represents the Variable ID that will store the 
 * result of the Input.
 * The value that is stored is the number of frames it took for the Input
 * condition to become true after the check for Input started.
 *
 *
 * Examples:
 *
 *   START SEQUENCE INPUT: ok, 3
 *   START SEQUENCE INPUT: escape, 5
 *   START SEQUENCE INPUT: shift, 23
 *
 *
 * ==========================================================================
 *  END SEQUENCE INPUT
 * ==========================================================================
 *
 * If you wish to stop the check for Input, use:
 *
 *   END SEQUENCE INPUT
 *
 * This will simply stop the Input check.
 * If no Input was detected from the start to the end, then the Variable 
 * will be set to 0.
 *
 *
 * Example:
 *
 *   END SEQUENCE INPUT
 *
 *
 * ==========================================================================
 *  WAIT FOR SEQUENCE INPUT
 * ==========================================================================
 *
 * Using this Action, the Action Sequence will wait until the Input has been
 * preformed:
 *
 *   WAIT FOR SEQUENCE INPUT
 *
 * This will simply keep things waiting until the Input happens.
 *
 *
 * However, say for example, you wish to have a maximum amount of time that
 * will be waited before the Sequence Input is just skipped altogether? 
 *
 *   WAIT FOR SEQUENCE INPUT: maxFrames
 *
 * Using this Action, the Actions will still wait for the Input to occur.
 * However, if 'maxFrames' have passed, and the Input has not occured, then
 * the wait will end and the Variable will be set to 0.
 *
 *
 * Examples:
 *
 *   WAIT FOR SEQUENCE INPUT
 *   WAIT FOR SEQUENCE INPUT: 5
 *   WAIT FOR SEQUENCE INPUT: 30
 *
 *
 * ==========================================================================
 *  End of Help File
 * ==========================================================================
 * 
 * Welcome to the bottom of the Help file.
 *
 *
 * Thanks for reading!
 * If you have questions, or if you enjoyed this Plugin, please check
 * out my YouTube channel!
 *
 * https://www.youtube.com/c/SumRndmDde
 *
 *
 * Until next time,
 *   ~ SumRndmDde
 *
 */

var SRD = SRD || {};
SRD.SequenceInput = SRD.SequenceInput || {};

var Imported = Imported || {};
Imported["SumRndmDde Sequence Input"] = 1.00;

if(Imported.YEP_BattleEngineCore) {

(function(_) {

var params = PluginManager.parameters('SRD_SequenceInput');

_.customInputs = [];
for(var i = 1; i <= 50; i++) {
	var name = String(params['Name Input 1']);
	var input = String(params['Condition Input 1']);
	if(name.trim().length > 0 && input.trim().length) {
		_.customInputs[i] = {};
		_.customInputs[i].name = name.trim().toLowerCase();
		_.customInputs[i].input = input;
	}
}

_.getInput = function(name) {
	for(var i = 1; i < _.customInputs.length; i++) {
		if(_.customInputs[i] && _.customInputs[i].name === name) {
			return _.customInputs[i].input;
		}
	}
	return null;
}

//-----------------------------------------------------------------------------
// BattleManager
//-----------------------------------------------------------------------------

var _BattleManager_initMembers = BattleManager.initMembers;
BattleManager.initMembers = function() {
	_BattleManager_initMembers.call(this);
	this._isSequenceChecking_Input = false;
	this._sequenceInputCheckingFrame = 0;
	this._sequenceInputWaitLimit = 0;
	this._sequenceInputIsComplete = false;
};

var _BattleManager_processActionSequence =  BattleManager.processActionSequence;
BattleManager.processActionSequence = function(actionName, actionArgs) {
	if(actionName === 'START SEQUENCE INPUT') {
		return this.startSequenceInput(actionArgs);
	}
	if(actionName === 'END SEQUENCE INPUT') {
		return this.endSequenceInput();
	}
	if(actionName === 'WAIT FOR SEQUENCE INPUT') {
		return this.waitForSequenceInput(actionArgs);
	}
	return _BattleManager_processActionSequence.call(this, actionName, actionArgs);
};

var _BattleManager_update = BattleManager.update;
BattleManager.update = function() {
	_BattleManager_update.call(this);
	this.checkSequenceInput();
};

BattleManager.checkSequenceInput = function() {
	if(!!this._isSequenceChecking_Input) {
		this._sequenceInputCheckingFrame++;
		if(eval(this._isSequenceChecking_Input[0]) && !this._sequenceInputIsComplete) {
			$gameVariables.setValue(this._isSequenceChecking_Input[1], this._sequenceInputCheckingFrame);
			this._sequenceInputIsComplete = true;
			if(this._logWindow._waitMode === 'sequence-input') {
				this.endSequenceInput();
			}
		} else if(this._logWindow._waitMode === 'sequence-input' && this._sequenceInputWaitLimit != 0 && 
			this._sequenceInputWaitLimit <= this._sequenceInputCheckingFrame) {
			$gameVariables.setValue(this._isSequenceChecking_Input[1], 0);
			this.endSequenceInput();
		}
	}
};

BattleManager.startSequenceInput = function(stuff) {
	var input = String(stuff[0]).trim().toLowerCase();
	var varib = parseInt(stuff[1]);
	this._isSequenceChecking_Input = [];
	this._isSequenceChecking_Input[0] = _.getInput(input) || "Input.isTriggered('" + input + "')";
	this._isSequenceChecking_Input[1] = varib;
	$gameVariables.setValue(this._isSequenceChecking_Input[1], 0);
};

BattleManager.endSequenceInput = function() {
	this._isSequenceChecking_Input = false;
	this._sequenceInputCheckingFrame = 0;
	this._sequenceInputWaitLimit = 0;
	this._sequenceInputIsComplete = false;
};

BattleManager.waitForSequenceInput = function(frameLimit) {
	this._logWindow.waitForSequenceInput();
	if(frameLimit && frameLimit[0]) this._sequenceInputWaitLimit = parseInt(frameLimit[0])
};

BattleManager.isCheckingForSequenceInput = function() {
	return !!this._isSequenceChecking_Input;
};

//-----------------------------------------------------------------------------
// Window_BattleLog
//-----------------------------------------------------------------------------

var _Window_BattleLog_updateWaitMode = Window_BattleLog.prototype.updateWaitMode;
Window_BattleLog.prototype.updateWaitMode = function() {
	if(this._waitMode === 'sequence-input') {
		if(BattleManager.isCheckingForSequenceInput()) return true;
	}
	return _Window_BattleLog_updateWaitMode.call(this);
};

Window_BattleLog.prototype.waitForSequenceInput = function() {
	this.setWaitMode('sequence-input');
};

})(SRD.SequenceInput);

} else alert('HEY! You\'re using SRD_SequenceInput, but that Plugin requires YEP_BattleEngineCore!');